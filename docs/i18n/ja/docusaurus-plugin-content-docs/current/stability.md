# 安定性と後方互換性

このドキュメントでは、Laravel Spectrumの安定性保証と後方互換性ポリシーについて説明します。

## バージョニング

Laravel Spectrumは[セマンティック バージョニング 2.0.0](https://semver.org/lang/ja/)に従います：

- **メジャー**バージョン (X.0.0): パブリックAPIの破壊的変更
- **マイナー**バージョン (0.X.0): 後方互換性のある新機能
- **パッチ**バージョン (0.0.X): 後方互換性のあるバグ修正

## パブリックAPIの定義

以下のコンポーネントは**パブリックAPI**として扱われ、後方互換性の保証対象となります：

### Artisanコマンド

| コマンド | 説明 |
|---------|------|
| `spectrum:generate` | OpenAPIドキュメントの生成 |
| `spectrum:mock` | モックAPIサーバーの起動 |
| `spectrum:export:postman` | Postmanコレクションへのエクスポート |
| `spectrum:export:insomnia` | Insomniaコレクションへのエクスポート |

コマンド名、必須引数、オプションの動作はマイナー/パッチリリースで変更されません。

### 設定 (`config/spectrum.php`)

すべての設定キーとその期待される値の型は安定しています。新しい設定オプションはマイナーリリースで追加される場合がありますが、適切なデフォルト値が設定されます。

### コントラクト（インターフェース）

`src/Contracts/`内のインターフェースは安定しています：

- `HasCustomExamples` - カスタムサンプル生成
- `HasExamples` - リソースサンプル定義
- `HasErrors` - エラー収集
- `ExampleGenerationStrategy` - カスタム生成戦略
- `src/Contracts/Analyzers/`内のアナライザーコントラクト
- `src/Contracts/Performance/`内のパフォーマンスコントラクト

### 生成される出力

生成されるOpenAPI 3.0仕様の構造は安定しています。出力は常に有効なOpenAPI 3.0形式を維持します。

## 保証対象外

以下は**内部実装の詳細**であり、予告なく変更される可能性があります：

- `src/Analyzers/Support/`内の内部クラス
- プライベート/プロテクテッドメソッド
- クラスコンストラクタのシグネチャ（依存性注入コンテナを使用してください）
- PHPStanベースラインのエントリ
- テストフィクスチャとテストユーティリティ
- 開発依存パッケージ

## 後方互換性の約束

### マイナー/パッチリリース内

以下を保証します：

1. **CLIコマンド** - 同じ動作、オプションの削除なし
2. **設定** - 既存のキーは同じように動作
3. **コントラクト** - インターフェースの破壊的変更なし
4. **OpenAPI出力** - 有効な3.0仕様形式

### 変更される可能性があるもの

マイナー/パッチリリースでも以下は変更される可能性があります：

1. **バグ修正** - 誤った動作が修正される場合があります
2. **解析の改善** - より良い型推論によりルート/パラメータの検出が増える場合があります
3. **生成されるサンプル** - Fakerで生成される値は決定的ではありません
4. **エラーメッセージ** - 文言が改善される場合があります
5. **パフォーマンス** - 内部最適化

## 非推奨ポリシー

機能が非推奨になる場合：

1. **告知** - CHANGELOG.mdに非推奨として記載
2. **警告** - 少なくとも1つのマイナーバージョンで実行時の非推奨警告を表示
3. **ドキュメント** - 移行ガイドを提供
4. **削除** - 次のメジャーバージョンでのみ削除

### 非推奨アノテーション

```php
/**
 * @deprecated since 1.2.0, NewClassを代わりに使用してください
 */
```

## サポートバージョン

| バージョン | PHP | Laravel | ステータス |
|-----------|-----|---------|----------|
| 1.x | 8.1 - 8.4 | 11.x, 12.x | アクティブ |

セキュリティ修正は、新しいメジャーリリース後少なくとも12ヶ月間、サポート対象バージョンにバックポートされます。

## 推奨される使用方法

安定性のために、以下を推奨します：

```json
{
    "require": {
        "wadakatu/laravel-spectrum": "^1.0"
    }
}
```

キャレット (`^`) 制約を使用することで、破壊的変更を避けながらバグ修正と新機能を受け取ることができます。

**常に`composer.lock`をコミット**して、環境間で一貫した動作を確保してください。

## 互換性の問題を報告する

マイナー/パッチリリースで予期しない破壊的変更が発生した場合は、以下の情報を添えて[Issueを作成](https://github.com/wadakatu/laravel-spectrum/issues)してください：

1. 以前動作していたバージョン
2. 現在問題が発生しているバージョン
3. 問題を示すコードサンプル
4. 期待される動作と実際の動作
